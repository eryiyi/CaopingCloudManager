<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC
        "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.liangxunwang.unimanager.dao.CpJixieDao">
    <resultMap id="cpJixie" type="com.liangxunwang.unimanager.model.CpJixie">
        <id column="cloud_jixie_id" property="cloud_jixie_id"/>
        <result column="emp_id" property="emp_id"/>
        <result column="cloud_jixie_title" property="cloud_jixie_title"/>
        <result column="cloud_jixie_content" property="cloud_jixie_content"/>
        <result column="cloud_jixie_prices" property="cloud_jixie_prices"/>
        <result column="cloud_jixie_guige_id" property="cloud_jixie_guige_id"/>
        <result column="cloud_jixie_pic" property="cloud_jixie_pic"/>
        <result column="cloud_jixie_use_id" property="cloud_jixie_use_id"/>
        <result column="cloud_jixie_address" property="cloud_jixie_address"/>
        <result column="cloud_jixie_dateline" property="cloud_jixie_dateline"/>
        <result column="cloud_jixie_is_use" property="cloud_jixie_is_use"/>
        <result column="cloud_jixie_is_del" property="cloud_jixie_is_del"/>
        <result column="lat" property="lat"/>
        <result column="lng" property="lng"/>
        <result column="sale_count" property="sale_count"/>

        <result column="emp_name" property="emp_name"/>
        <result column="emp_cover" property="emp_cover"/>
        <result column="cloud_jixie_guige_cont" property="cloud_jixie_guige_cont"/>
        <result column="cloud_jixie_use_cont" property="cloud_jixie_use_cont"/>
    </resultMap>

    <select id="lists" resultMap="cpJixie">
        SELECT sn.*,le.emp_name as emp_name, le.emp_cover as emp_cover,lgg.cloud_jixie_guige_cont as cloud_jixie_guige_cont
        ,luse.cloud_jixie_use_cont as cloud_jixie_use_cont
        from cloud_jixie sn
        LEFT JOIN lx_emp le ON le.emp_id = sn.emp_id
        LEFT JOIN cloud_jixie_guige lgg ON lgg.cloud_jixie_guige_id = sn.cloud_jixie_guige_id
        LEFT JOIN cloud_jixie_use luse ON luse.cloud_jixie_use_id = sn.cloud_jixie_use_id
        where 1 = 1
        <if test="emp_id != null and emp_id != ''">
            AND sn.emp_id = #{emp_id}
        </if>

        <if test="cloud_jixie_guige_id != null and cloud_jixie_guige_id != ''">
            AND sn.cloud_jixie_guige_id = #{cloud_jixie_guige_id}
        </if>

        <if test="cloud_jixie_use_id != null and cloud_jixie_use_id != ''">
            AND sn.cloud_jixie_use_id = #{cloud_jixie_use_id}
        </if>

        <if test="cloud_jixie_is_use != null and cloud_jixie_is_use != ''">
            AND sn.cloud_jixie_is_use = #{cloud_jixie_is_use}
        </if>
        <if test="cloud_jixie_is_del != null and cloud_jixie_is_del != ''">
            AND sn.cloud_jixie_is_del = #{cloud_jixie_is_del}
        </if>

        <if test="keyWords !=null and keyWords !=''">
            AND (sn.cloud_jixie_title like CONCAT('%',#{keyWords},'%') OR sn.cloud_jixie_content like CONCAT('%',#{keyWords},'%') OR sn.cloud_jixie_address like CONCAT('%',#{keyWords},'%') OR le.emp_name like CONCAT('%',#{keyWords},'%') )
        </if>

        <if test="lat != null and lat != ''">
            AND sn.lat > (#{lat}-1) AND   (#{lat} + 1) > sn.lat
        </if>
        <if test="lng != null and lng != ''">
            AND sn.lng > (#{lng}-1) AND   (#{lng} + 1) > sn.lng
        </if>
         <if test="is_time != null and is_time != '' and is_time == '1'">
             ORDER BY sn.cloud_jixie_dateline DESC
        </if>
        <if test="is_count != null and is_count != '' and is_count == '1'">
             ORDER BY sn.sale_count DESC
        </if>
        limit #{index},#{size}
    </select>

    <insert id="save" parameterType="com.liangxunwang.unimanager.model.CpJixie">
        INSERT INTO cloud_jixie(cloud_jixie_id, emp_id, cloud_jixie_title, cloud_jixie_content,cloud_jixie_prices , cloud_jixie_guige_id, cloud_jixie_pic, cloud_jixie_use_id,cloud_jixie_address ,cloud_jixie_dateline , cloud_jixie_is_use, cloud_jixie_is_del, lat,lng )
        VALUES (#{cloud_jixie_id}, #{emp_id}, #{cloud_jixie_title}, #{cloud_jixie_content}, #{cloud_jixie_prices}, #{cloud_jixie_guige_id}, #{cloud_jixie_pic},  #{cloud_jixie_use_id}, #{cloud_jixie_address}, #{cloud_jixie_dateline}, #{cloud_jixie_is_use}, #{cloud_jixie_is_del}, #{lat}, #{lng})
    </insert>

    <delete id="delete" parameterType="String">
        DELETE FROM cloud_jixie where cloud_jixie_id = #{cloud_jixie_id}
    </delete>

    <select id="findById" parameterType="String" resultMap="cpJixie">
      SELECT sn.*,le.emp_name as emp_name, le.emp_cover as emp_cover,lgg.cloud_jixie_guige_cont as cloud_jixie_guige_cont
        ,luse.cloud_jixie_use_cont as cloud_jixie_use_cont
        from cloud_jixie sn
        LEFT JOIN lx_emp le ON le.emp_id = sn.emp_id
        LEFT JOIN cloud_jixie_guige lgg ON lgg.cloud_jixie_guige_id = sn.cloud_jixie_guige_id
        LEFT JOIN cloud_jixie_use luse ON luse.cloud_jixie_use_id = sn.cloud_jixie_use_id
         where sn.cloud_jixie_id=#{cloud_jixie_id}
    </select>

    <update id="update" parameterType="com.liangxunwang.unimanager.model.CpJixie">
        UPDATE cloud_jixie_guige SET cloud_jixie_title=#{cloud_jixie_title},
        cloud_jixie_content=#{cloud_jixie_content},
        cloud_jixie_prices=#{cloud_jixie_prices},
        cloud_jixie_guige_id=#{cloud_jixie_guige_id},
        cloud_jixie_use_id=#{cloud_jixie_use_id},
        cloud_jixie_content=#{cloud_jixie_content},
        cloud_jixie_is_use=#{cloud_jixie_is_use},
        cloud_jixie_is_del=#{cloud_jixie_is_del}
         WHERE cloud_jixie_id=#{cloud_jixie_id}
    </update>
</mapper>